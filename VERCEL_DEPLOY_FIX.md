# حل مشكلة النشر على Vercel

بعد مراجعة مشروعك والروابط التي قدمتها، إليك الخطوات اللازمة لإصلاح مشكلة النشر على Vercel:

## تشخيص المشكلة

تواجه مشكلة محددة في عملية البناء على Vercel تتعلق بمكتبة Rollup:

```
Error: Cannot find module @rollup/rollup-linux-x64-gnu. npm has a bug related to optional dependencies (https://github.com/npm/cli/issues/4828). Please try `npm i` again after removing both package-lock.json and node_modules directory.
```

هذه مشكلة معروفة تتعلق بالتبعيات الاختيارية في npm وكيفية تعامل Vercel معها.

## الإصلاحات التي تم إجراؤها

1. **إزالة النسخة المكررة من ملف vercel.json**
   - تم حذف النسخة الموجودة في مجلد `src` لتجنب التعارض

2. **تحديث ملف vercel.json الرئيسي**
   - تم إضافة إعدادات أكثر تفصيلاً لتوجيه Vercel بشكل صحيح
   - تم تحديد إطار العمل (Vite) وأوامر البناء ومجلد الإخراج

## حل مشكلة Rollup والتبعيات الاختيارية (تحديث)

1. **تعديل ملف package.json**
   - أضف القسم التالي إلى ملف package.json لتجاوز مشكلة التبعيات الاختيارية:
   ```json
   "overrides": {
     "rollup": "^4.9.0"
   }
   ```
   - هذا سيجبر المشروع على استخدام إصدار محدد من Rollup بدلاً من الاعتماد على التبعيات الاختيارية المرتبطة بنظام التشغيل

2. **تحديث ملف vercel.json**
   - قم بتعديل ملف vercel.json لاستخدام الخيار `--omit=optional` بدلاً من `--no-optional` (الذي أصبح قديمًا):
   ```json
   {
     "framework": "vite",
     "buildCommand": "npm run build",
     "outputDirectory": "dist",
     "installCommand": "npm install --omit=optional",
     "rewrites": [
       { "source": "/(.*)", "destination": "/index.html" }
     ]
   }
   ```
   - هذا التغيير يستخدم الصيغة الحديثة لتجاوز التبعيات الاختيارية في npm
   - تم إزالة الاعتماد على ملف bash لأن Vercel قد لا يدعم تنفيذ ملفات bash بشكل صحيح

## خطوات النشر على Vercel

1. **قم بدفع التغييرات إلى GitHub**
   ```bash
   git add .
   git commit -m "إصلاح مشكلة Rollup في Vercel"
   git push origin main
   ```

2. **أعد ربط مشروعك بـ Vercel**
   - قم بزيارة [Vercel](https://vercel.com/dashboard)
   - انقر على "Add New" ثم "Project"
   - اختر مستودع GitHub الخاص بك `ahmed-sayed37/E-commerce`
   - في إعدادات المشروع:
     - تأكد من تعيين "Framework Preset" إلى "Vite"
     - تأكد من أن "Root Directory" هو `./` (المجلد الرئيسي)
     - اترك "Build Command" و "Output Directory" فارغين لأن ملف vercel.json سيتولى تحديدهما

3. **تجاوز الإعدادات المخزنة مسبقًا (إذا لزم الأمر)**
   - إذا كنت قد حاولت النشر سابقًا، فقد تحتاج إلى حذف المشروع من Vercel وإعادة إضافته
   - انتقل إلى [مشروعك على Vercel](https://vercel.com/ahmed-sayed37s-projects/e-commerce/)
   - انتقل إلى "Settings" > "General" > "Delete Project"
   - ثم أعد إضافة المشروع باتباع الخطوة 2

4. **تحقق من سجلات البناء**
   - بعد بدء عملية النشر، راقب سجلات البناء للتحقق من أي أخطاء
   - يمكنك الوصول إلى السجلات من خلال علامة التبويب "Deployments" في لوحة تحكم Vercel

## نصائح إضافية لحل المشكلات

1. **تأكد من توافق الإصدارات**
   - لاحظت أنك تستخدم React 19.1.0، وهو إصدار حديث جدًا
   - تأكد من أن جميع التبعيات متوافقة مع بعضها البعض

2. **تحقق من متغيرات البيئة**
   - إذا كان مشروعك يستخدم متغيرات بيئة، تأكد من إضافتها في إعدادات Vercel
   - انتقل إلى "Settings" > "Environment Variables" في لوحة تحكم Vercel

3. **استخدم وضع التطوير المحلي لـ Vercel**
   - يمكنك تثبيت Vercel CLI واختبار البناء محليًا قبل النشر:
   ```bash
   npm i -g vercel
   vercel dev
   ```

## الإجراءات التي تم تنفيذها لحل مشكلة Rollup (تحديث)

لقد قمنا بتنفيذ الإجراءات التالية لحل مشكلة Rollup:

1. **تحديث ملف `vercel.json`**
   - تم تغيير أمر التثبيت إلى: `npm install --omit=optional` بدلاً من `--no-optional`
   - تم إزالة الاعتماد على ملف bash واستخدام أمر البناء المباشر: `npm run build`

2. **تحديث ملف `package.json`**
   - تمت إضافة قسم `overrides` لتحديد إصدار محدد من Rollup (4.9.0) لتجنب المشكلة

**ملاحظة مهمة**: تم تحديث الحل بعد ظهور رسالة خطأ تشير إلى أن الخيار `--no-optional` أصبح قديمًا وأن الخيار الموصى به هو `--omit=optional`. كما تم إزالة الاعتماد على ملف bash لأن Vercel قد لا يدعم تنفيذ ملفات bash بشكل صحيح.

هذه التغييرات تعالج مشكلة التبعيات الاختيارية في npm التي تسبب فشل عملية البناء على Vercel. بعد دفع هذه التغييرات إلى GitHub وإعادة ربط المشروع بـ Vercel، يجب أن يتم نشر مشروعك بنجاح.

**إذا استمرت المشكلة**: يرجى الاطلاع على ملف [ROLLUP_FIX_STEPS.md](./ROLLUP_FIX_STEPS.md) للحصول على خطوات إضافية وحلول بديلة لمشكلة Rollup.

بعد اتباع هذه الخطوات، يجب أن يتم نشر مشروعك على Vercel بنجاح. إذا استمرت المشكلة، فقم بمراجعة سجلات البناء للحصول على معلومات أكثر تفصيلاً حول الخطأ.